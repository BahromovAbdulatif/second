<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Админ-панель — Конференции</title>
<style>
  :root{
    --bg:#f3f6fb; --panel:#fff; --ink:#0f172a; --muted:#64748b;
    --brand:#1e66ff; --brand-600:#1557df; --ring:#c7d7ff; --border:#e5e7eb;
    --shadow:0 8px 18px rgba(2,6,23,.06), 0 2px 6px rgba(2,6,23,.04);
    --radius:12px;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;background:linear-gradient(180deg,#e9f0ff 0%, #f6f8ff 120%);
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial,sans-serif;
    font-size:14px; line-height:1.4; color:var(--ink)
  }
  a{color:inherit;text-decoration:none}

  /* Topbar */
  .topbar{position:sticky;top:0;z-index:50;background:rgba(255,255,255,.9);backdrop-filter:saturate(1.2) blur(6px);border-bottom:1px solid var(--border)}
  .topbar-inner{max-width:1280px;margin:0 auto;display:flex;align-items:center;justify-content:space-between;padding:10px 16px}
  .brand{display:flex;gap:8px;align-items:center;font-weight:800}
  .brand-badge{width:22px;height:22px;border-radius:6px;background:#0b3ea9}
  .tabs{display:flex;gap:4px;flex-wrap:wrap}
  .tab{padding:8px 10px;border-radius:9px;cursor:pointer;font-weight:700;color:#1f2a5a;font-size:13px}
  .tab.active{background:#eef2ff;color:#0b3ea9}

  /* Layout */
  .wrap{max-width:1280px;margin:18px auto;padding:0 16px}
  .card{background:var(--panel);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);overflow:hidden}
  .card-head{display:flex;align-items:center;justify-content:space-between;padding:12px 14px;border-bottom:1px solid var(--border)}
  .card-title{margin:0;font-size:16px;font-weight:800}
  .card-body{padding:12px 14px}
  .btn{appearance:none;border:0;border-radius:10px;padding:8px 12px;font-weight:800;cursor:pointer;transition:filter .15s, transform .03s;font-size:13px}
  .btn:active{transform:translateY(1px)}
  .btn.primary{background:var(--brand);color:#fff;box-shadow:0 6px 14px rgba(30,102,255,.18)}
  .btn.ghost{background:#eef2ff;color:#1f2a5a}
  .btn.icon{display:inline-flex;align-items:center;gap:6px}
  .muted{color:var(--muted);font-size:12px}

  /* Table */
  .table-wrap{overflow:auto}
  .table{width:100%;border-collapse:separate;border-spacing:0;min-width:900px}
  .table th,.table td{padding:10px;border-bottom:1px solid var(--border);text-align:left;vertical-align:top;font-size:13px}
  .table th{color:#334155;background:#f8fafc;font-weight:800}
  .table tr:hover td{background:#fafbff}
  .badge{display:inline-block;padding:3px 7px;border-radius:999px;font-size:11px;background:#eef2ff;color:#0b3ea9;font-weight:800}

  /* Sections */
  .section{display:none}
  .section.active{display:block}

  /* -------- Modal (GRID + компакт) -------- */
  .modal-backdrop{
    position: fixed; inset: 0; background: rgba(2,6,23,.5);
    display: none; align-items: center; justify-content: center;
    padding: 12px; z-index: 100;
  }
  .modal-backdrop.show{ display:flex; }

  /* ШИРЕ и НИЖЕ высота: 1100px макс ширины и 80dvh высоты */
  .modal{
    width: min(1100px, 96vw);
    height: 80dvh;                    /* ниже, чтобы точно появлялся скролл */
    display: grid; grid-template-rows: auto 1fr auto;
    background:#fff; border-radius:12px; border:1px solid var(--border); box-shadow:var(--shadow); overflow:hidden;
  }
  .modal-head{display:flex;justify-content:space-between;align-items:center;padding:10px 12px;background:#0b3ea9;color:#fff}
  .modal-title{margin:0;font-weight:900;font-size:15px}
  .modal-body{
    overflow:auto; -webkit-overflow-scrolling:touch; overscroll-behavior:contain;
    padding:12px; gap:10px;
  }
  .modal-actions{display:flex;gap:8px;justify-content:flex-end;padding:10px 12px;border-top:1px solid var(--border);background:#f8fafc}

  /* Form (компактнее + 3 колонки на широких экранах) */
  .modal-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
  .form-row{display:flex;flex-direction:column;gap:6px}
  label{font-size:12px;font-weight:900}
  .req::after{content:" *";color:#ef4444}
  input[type="text"],input[type="date"],input[type="time"],input[type="number"],input[type="tel"]{
    width:100%;padding:8px 10px;border:1px solid var(--border);border-radius:8px;font:inherit;background:#fff;outline:none;transition:border .15s, box-shadow .15s;font-size:13px
  }
  input:focus{border-color:var(--brand);box-shadow:0 0 0 3px var(--ring)}

  .subcard{border:1px dashed var(--border);border-radius:10px;padding:10px;margin-top:10px}
  .subhead{display:flex;align-items:center;justify-content:space-between;margin-bottom:6px}
  .row-grid{display:grid;grid-template-columns:1.2fr 1fr .22fr;gap:8px;margin-bottom:8px}
  .row-grid.participants{grid-template-columns:1.2fr 1fr .22fr}
  .remove{background:#fff;border:1px solid var(--border);border-radius:8px;padding:6px;cursor:pointer;font-size:14px}
  .remove:hover{filter:brightness(.98)}

  /* Analytics bars (компактнее) */
  .bar{display:flex;align-items:center;gap:8px;margin:8px 0}
  .bar-label{width:38%;min-width:180px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;font-size:13px}
  .bar-track{flex:1;height:10px;background:#eef2ff;border-radius:999px;overflow:hidden}
  .bar-fill{height:100%;background:linear-gradient(90deg,#4b7bff,#1e66ff);border-radius:999px}
  .bar-value{min-width:70px;text-align:right;font-variant-numeric:tabular-nums;font-size:12px}

  @media(max-width:1100px){ .modal-grid{grid-template-columns:repeat(2,1fr)} }
  @media(max-width:720px){
    .modal{ width:100%; height:100dvh; border-radius:0 }
    .modal-body{ padding:10px }
    .modal-grid{ grid-template-columns:1fr }
    .row-grid,.row-grid.participants{ grid-template-columns:1fr 1fr .22fr }
    .tabs{ gap:3px }
  }
</style>
</head>
<body>

<header class="topbar">
  <div class="topbar-inner">
    <div class="brand"><span class="brand-badge"></span> Admin Panel</div>
    <nav class="tabs" id="tabs">
      <a class="tab active" data-target="sec-home">Главная</a>
      <a class="tab" data-target="sec-analytics">Аналитика</a>
      <a class="tab" data-target="sec-projects">Проекты</a>
      <a class="tab" data-target="sec-people">Участники</a>
      <a class="tab" data-target="sec-settings">Настройки</a>
    </nav>
  </div>
</header>

<main class="wrap">
  <!-- Главная -->
  <section id="sec-home" class="section active">
    <div class="card">
      <div class="card-head">
        <h2 class="card-title">Список проектов (конференции)</h2>
        <button class="btn primary icon" id="btn-new">➕ Создать проект</button>
      </div>
      <div class="card-body">
        <div class="table-wrap">
          <table class="table">
            <thead>
              <tr>
                <th>#</th><th>Название</th><th>Дата начала</th><th>Дата окончания</th>
                <th>Время начала</th><th>Время окончания</th><th>Сумма</th><th>Компания</th><th>Статус</th>
              </tr>
            </thead>
            <tbody id="projects-tbody">
              <tr>
                <td>1</td><td>Design Summit 2025</td><td>2025-05-12</td><td>2025-05-13</td>
                <td>09:00</td><td>18:00</td><td>12 000 000 UZS</td><td>BlueWave Events</td>
                <td><span class="badge">Черновик</span></td>
              </tr>
              <tr>
                <td>2</td><td>Startup Meetup</td><td>2025-07-02</td><td>2025-07-02</td>
                <td>18:30</td><td>21:00</td><td>3 500 000 UZS</td><td>Rocket Group</td>
                <td><span class="badge">Опубликован</span></td>
              </tr>
            </tbody>
          </table>
        </div>
        <p class="muted" style="margin-top:6px">Нажмите «Создать проект», чтобы добавить конференцию, спикеров и участников.</p>
      </div>
    </div>
  </section>

  <!-- Аналитика -->
  <section id="sec-analytics" class="section">
    <div class="card">
      <div class="card-head"><h2 class="card-title">Аналитика</h2></div>
      <div class="card-body">
        <h3 style="margin:4px 0 8px;font-size:15px">1) ТОП компаний по метрике (∑оценок / 365 / N)</h3>
        <div id="bars-companies"></div>

        <h3 style="margin:14px 0 8px;font-size:15px">2) ТОП спикеров по метрике (∑оценок / 365 / N)</h3>
        <div id="bars-speakers"></div>

        <h3 style="margin:14px 0 8px;font-size:15px">3) ТОП проектов по средней оценке</h3>
        <div id="bars-projects"></div>

        <p class="muted">Данные — пример. Подключите ваш API и подставьте реальные цифры.</p>
      </div>
    </div>
  </section>

  <!-- Заглушки -->
  <section id="sec-projects" class="section">
    <div class="card"><div class="card-head"><h2 class="card-title">Проекты</h2></div><div class="card-body">Фильтры, экспорт — далее.</div></div>
  </section>
  <section id="sec-people" class="section">
    <div class="card"><div class="card-head"><h2 class="card-title">Участники</h2></div><div class="card-body">Сводный список участников.</div></div>
  </section>
  <section id="sec-settings" class="section">
    <div class="card"><div class="card-head"><h2 class="card-title">Настройки</h2></div><div class="card-body">SMS-провайдер, роли и т.д.</div></div>
  </section>
</main>

<!-- Модалка: Создать проект -->
<div class="modal-backdrop" id="modal">
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modal-title">
    <div class="modal-head">
      <h3 class="modal-title" id="modal-title">Создать проект (конференцию)</h3>
      <button class="btn ghost" id="close-modal" aria-label="Закрыть">✕</button>
    </div>

    <form id="project-form">
      <div class="modal-body">
        <!-- Основные поля -->
        <div class="modal-grid">
          <div class="form-row">
            <label class="req" for="p-name">Название</label>
            <input id="p-name" type="text" placeholder="Design Summit 2025" required>
          </div>
          <div class="form-row">
            <label class="req" for="p-company">Компания-организатор</label>
            <input id="p-company" type="text" placeholder="BlueWave Events" required>
          </div>
          <div class="form-row">
            <label class="req" for="p-place">Место / Адрес</label>
            <input id="p-place" type="text" placeholder="г. Ташкент, ул. Навои, 12" required>
          </div>

          <div class="form-row">
            <label class="req" for="p-manager-phone">Телефон менеджера</label>
            <input id="p-manager-phone" type="tel" inputmode="tel" placeholder="+998 (__) ___-__-__" pattern="^\\+?\\d[\\d\\s\\-()]{6,}$" required>
          </div>
          <div class="form-row">
            <label class="req" for="p-date-start">Дата начала</label>
            <input id="p-date-start" type="date" required>
          </div>
          <div class="form-row">
            <label class="req" for="p-date-end">Дата окончания</label>
            <input id="p-date-end" type="date" required>
          </div>

          <div class="form-row">
            <label class="req" for="p-time-start">Время начала</label>
            <input id="p-time-start" type="time" required>
          </div>
          <div class="form-row">
            <label class="req" for="p-time-end">Время окончания</label>
            <input id="p-time-end" type="time" required>
          </div>

          <div class="form-row">
            <label class="req" for="p-amount">Сумма (UZS)</label>
            <input id="p-amount" type="number" min="0" step="1000" placeholder="0" required>
          </div>
          <div class="form-row">
            <label for="p-status">Статус</label>
            <input id="p-status" type="text" placeholder="Черновик / Опубликован">
          </div>
        </div>

        <!-- Спикеры -->
        <div class="subcard" id="speakers-card">
          <div class="subhead">
            <strong>Спикеры</strong>
            <button class="btn ghost" type="button" id="add-speaker">+ Добавить спикера</button>
          </div>
          <div id="speakers-list"></div>
          <p class="muted">Имя и тема выступления. Можно добавить несколько.</p>
        </div>

        <!-- Участники -->
        <div class="subcard" id="participants-card">
          <div class="subhead">
            <strong>Участники</strong>
            <button class="btn ghost" type="button" id="add-participant">+ Добавить участника</button>
          </div>
          <div id="participants-list"></div>
          <p class="muted">Имя и номер телефона (для SMS с одноразовой ссылкой).</p>
        </div>
      </div>

      <div class="modal-actions">
        <button type="button" class="btn ghost" id="cancel">Отмена</button>
        <button type="submit" class="btn primary">Сохранить проект</button>
      </div>
    </form>
  </div>
</div>

<script>
  /* ---------- Tabs ---------- */
  const tabs=document.querySelectorAll('.tab');
  const sections=document.querySelectorAll('.section');
  tabs.forEach(t=>t.addEventListener('click',()=>{
    tabs.forEach(x=>x.classList.remove('active')); t.classList.add('active');
    const target=t.dataset.target; sections.forEach(s=>s.classList.toggle('active',s.id===target));
  }));

  /* ---------- Demo Analytics Data & Render (компакт) ---------- */
  const analyticsData = {
    companies: [
      { company: 'BlueWave Events', ratings: [8,9,7,9,8] },
      { company: 'Rocket Group',   ratings: [7,6,8,8,7,9] },
      { company: 'Nova Media',     ratings: [9,9,8,9] }
    ],
    speakers: [
      { speaker: 'Alice Kim', ratings: [9,8,9,10] },
      { speaker: 'Boris Ivanov', ratings: [7,7,8] },
      { speaker: 'Chen Li', ratings: [8,9,9,9,8] }
    ],
    projects: [
      { project: 'Design Summit 2025', ratings: [8,9,8,9,7] },
      { project: 'Startup Meetup', ratings: [7,8,8,7] },
      { project: 'AI Expo', ratings: [9,9,9] }
    ]
  };
  const metric=(sum,n)=> n? (sum/365)/n : 0;
  const avg=arr=> arr.length? arr.reduce((a,b)=>a+b,0)/arr.length : 0;
  function renderBars(containerId, rows, labelKey, valueFn){
    const cont=document.getElementById(containerId);
    cont.innerHTML='';
    if(!rows.length){ cont.textContent='Нет данных'; return; }
    const vals=rows.map(valueFn), max=Math.max(...vals,1);
    rows.map((r,i)=>({r,val:vals[i]})).sort((a,b)=>b.val-a.val).forEach(({r,val})=>{
      const wrap=document.createElement('div'); wrap.className='bar';
      const label=document.createElement('div'); label.className='bar-label'; label.textContent=r[labelKey];
      const track=document.createElement('div'); track.className='bar-track';
      const fill=document.createElement('div'); fill.className='bar-fill'; fill.style.width=(val/max*100).toFixed(1)+'%';
      const v=document.createElement('div'); v.className='bar-value'; v.textContent=val.toFixed(3);
      track.appendChild(fill); wrap.append(label, track, v); cont.appendChild(wrap);
    });
  }
  function recalcAnalytics(){
    renderBars('bars-companies', analyticsData.companies, 'company', (row)=>metric(row.ratings.reduce((a,b)=>a+b,0), row.ratings.length));
    renderBars('bars-speakers',  analyticsData.speakers,  'speaker', (row)=>metric(row.ratings.reduce((a,b)=>a+b,0), row.ratings.length));
    renderBars('bars-projects',  analyticsData.projects,  'project', (row)=>avg(row.ratings));
  }
  recalcAnalytics();

  /* ---------- Dynamic rows ---------- */
  const speakersList=document.getElementById('speakers-list');
  const participantsList=document.getElementById('participants-list');
  document.getElementById('add-speaker').addEventListener('click', addSpeakerRow);
  document.getElementById('add-participant').addEventListener('click', addParticipantRow);

  function addSpeakerRow(nameVal='', topicVal=''){
    const row=document.createElement('div');
    row.className='row-grid speaker-row';
    row.innerHTML=`
      <input type="text" placeholder="Имя спикера" value="${nameVal}">
      <input type="text" placeholder="Тема выступления" value="${topicVal}">
      <button class="remove" type="button" aria-label="Удалить">🗑</button>`;
    row.querySelector('.remove').onclick=()=>row.remove();
    speakersList.appendChild(row);
  }
  function addParticipantRow(nameVal='', phoneVal=''){
    const row=document.createElement('div');
    row.className='row-grid participants participant-row';
    row.innerHTML=`
      <input type="text" placeholder="Имя участника" value="${nameVal}">
      <input type="tel" placeholder="+998 (__) ___-__-__" value="${phoneVal}" pattern="^\\+?\\d[\\d\\s\\-()]{6,}$" title="Введите корректный номер">
      <button class="remove" type="button" aria-label="Удалить">🗑</button>`;
    row.querySelector('.remove').onclick=()=>row.remove();
    participantsList.appendChild(row);
  }

  /* ---------- Modal open/close (grid + scroll-safe) ---------- */
  const modal     = document.getElementById('modal');       // backdrop
  const btnNew    = document.getElementById('btn-new');
  const btnClose  = document.getElementById('close-modal');
  const btnCancel = document.getElementById('cancel');

  function openModal(){
    modal.classList.add('show');
    if(!document.querySelector('.speaker-row'))     addSpeakerRow();
    if(!document.querySelector('.participant-row')) addParticipantRow();
    // блокируем прокрутку ФОНА только у body (не у html)
    document.body.style.overflow = 'hidden';
  }
  function closeModal(){
    modal.classList.remove('show');
    document.body.style.overflow = '';
  }
  btnNew.addEventListener('click', openModal);
  btnClose.addEventListener('click', closeModal);
  btnCancel.addEventListener('click', closeModal);
  modal.addEventListener('click', (e)=>{ if(e.target===modal) closeModal(); });
  document.addEventListener('keydown',(e)=>{ if(e.key==='Escape' && modal.classList.contains('show')) closeModal(); });

  /* ---------- Demo "save": add row to table ---------- */
  const form=document.getElementById('project-form');
  form.addEventListener('submit',(e)=>{
    e.preventDefault();
    const payload={
      name:val('#p-name'), company:val('#p-company'),
      place:val('#p-place'), manager_phone:val('#p-manager-phone'),
      date_start:val('#p-date-start'), date_end:val('#p-date-end'),
      time_start:val('#p-time-start'), time_end:val('#p-time-end'),
      amount:val('#p-amount'), status:val('#p-status'),
      speakers:rows('.speaker-row'), participants:rows('.participant-row')
    };
    addProjectRow(payload);
    closeModal();
    form.reset();
    speakersList.innerHTML='';
    participantsList.innerHTML='';
    console.log('PROJECT_PAYLOAD', payload);
  });
  const val=sel=>document.querySelector(sel).value.trim();
  const rows=sel=>Array.from(document.querySelectorAll(sel)).map(r=>({a:r.children[0].value.trim(),b:r.children[1].value.trim()}));

  function addProjectRow(p){
    const tbody=document.getElementById('projects-tbody');
    const idx=tbody.children.length+1;
    const tr=document.createElement('tr');
    tr.innerHTML=`
      <td>${idx}</td><td>${p.name||'—'}</td>
      <td>${p.date_start||'—'}</td><td>${p.date_end||'—'}</td>
      <td>${p.time_start||'—'}</td><td>${p.time_end||'—'}</td>
      <td>${p.amount?Number(p.amount).toLocaleString('ru-RU')+' UZS':'—'}</td>
      <td>${p.company||'—'}</td>
      <td><span class="badge">${p.status||'Черновик'}</span></td>`;
    tbody.appendChild(tr);
  }
</script>
</body>
</html>
